{"version":3,"file":"commands.js","mappings":"AAOAA,OAAOC,SAAQ,WACb,IAkHFD,OAAOE,QAAQC,UAAU,UA3GzB,SAAgBC,GACd,IAAMC,EAAOL,OAAOM,QAAQC,QAAQF,KAEpC,IAAKA,EAGH,OAFAG,QAAQC,MAAM,yBACdL,EAAMM,UAAU,CAAEC,YAAY,IAIhCN,EAAKO,QAAQC,UAAS,SAACC,GACrB,GAAIA,EAAOC,SAAWf,OAAOgB,kBAAkBC,UAG7C,OAFAT,QAAQC,MAAM,iCAAkCK,EAAOL,YACvDL,EAAMM,UAAU,CAAEC,YAAY,IAIhC,IAAMC,EAAUE,EAAOI,OAAS,GAChCV,QAAQW,IAAI,oBAAqBP,GAEjC,IAAMQ,EAAqBR,EAAQS,MAAM,eACnCC,EAAgBF,EAAqBA,EAAmB,GAAK,KAEnE,IAAKE,EAGH,OAFAd,QAAQe,KAAK,8CACbnB,EAAMM,UAAU,CAAEC,YAAY,IAIhCH,QAAQW,IAAI,kCAAmCG,GAE/CjB,EAAKmB,qBAAoB,SAACV,GACxB,GAAIA,EAAOC,SAAWf,OAAOgB,kBAAkBC,UAG7C,OAFAT,QAAQC,MAAM,iCAAkCK,EAAOL,YACvDL,EAAMM,UAAU,CAAEC,YAAY,IAIhC,IAAMc,EAAcX,EAAOI,MAE3B,GAA2B,IAAvBO,EAAYC,OAGd,OAFAlB,QAAQW,IAAI,gEACZf,EAAMM,UAAU,CAAEC,YAAY,IAKhC,IAAMgB,EAAmBF,EAAYG,QAAO,SAAAC,GAAU,OACpDA,EAAWC,KAAKC,SAAS,UAAYF,EAAWC,KAAKC,SAAS,OAAO,IAGvE,GAAgC,IAA5BJ,EAAiBD,OAGnB,OAFAlB,QAAQW,IAAI,sEACZf,EAAMM,UAAU,CAAEC,YAAY,IAKLgB,EAAiBK,MAAK,SAAAH,GAAU,OACzDA,EAAWC,KAAKG,SAASX,EAAc,KAyCvCd,QAAQW,IAAI,qEACZf,EAAMM,UAAU,CAAEC,YAAY,MAtC9BH,QAAQe,KAAK,yCAMbvB,OAAOM,QAAQ4B,GAAGC,mBAJA,8CAMhB,CAAEC,OAAQ,GAAIC,MAAO,GAAIC,iBAAiB,IAC1C,SAAUC,GACR,GAAIA,EAAYxB,SAAWf,OAAOgB,kBAAkBC,UAGlD,OAFAT,QAAQC,MAAM,2BAA4B8B,EAAY9B,YACtDL,EAAMM,UAAU,CAAEC,YAAY,IAIhC,IAAM6B,EAASD,EAAYrB,MAG3BsB,EAAOC,gBACLzC,OAAO0C,UAAUC,uBACjB,SAAUC,GACRpC,QAAQW,IAAI,sBAAuByB,EAAKC,SACxCL,EAAOM,QAEc,cAAjBF,EAAKC,SACPrC,QAAQW,IAAI,qDACZf,EAAMM,UAAU,CAAEC,YAAY,MAE9BH,QAAQW,IAAI,0CACZf,EAAMM,UAAU,CAAEC,YAAY,IAElC,GAEJ,IAMN,GACF,GACF","sources":["webpack://office-addin-taskpane-js/./src/commands/commands.js"],"sourcesContent":["/*\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n * See LICENSE in the project root for license information.\n */\n\n/* global Office */\n\nOffice.onReady(() => {\n  // If needed, Office.js is ready to be called.\n});\n\n/**\n * Shows a notification when the add-in command is executed.\n * @param event {Office.AddinCommands.Event}\n */\nfunction action(event) {\n  const item = Office.context.mailbox.item;\n\n  if (!item) {\n    console.error(\"‚ùå No item found.\");\n    event.completed({ allowEvent: true });\n    return;\n  }\n\n  item.subject.getAsync((result) => {\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      console.error(\"‚ùå Failed to get email subject:\", result.error);\n      event.completed({ allowEvent: true });\n      return;\n    }\n\n    const subject = result.value || \"\";\n    console.log(\"üìå Email Subject:\", subject);\n\n    const projectNumberMatch = subject.match(/\\(([^)]+)\\)/);\n    const projectNumber = projectNumberMatch ? projectNumberMatch[1] : null;\n\n    if (!projectNumber) {\n      console.warn(\"‚ö† No project number found in subject.\");\n      event.completed({ allowEvent: true });\n      return;\n    }\n\n    console.log(\"üìå Project Number from subject:\", projectNumber);\n\n    item.getAttachmentsAsync((result) => {\n      if (result.status !== Office.AsyncResultStatus.Succeeded) {\n        console.error(\"‚ùå Failed to fetch attachments:\", result.error);\n        event.completed({ allowEvent: true });\n        return;\n      }\n\n      const attachments = result.value;\n\n      if (attachments.length === 0) {\n        console.log(\"üìÇ No attachments found. Proceeding with sending email.\");\n        event.completed({ allowEvent: true });\n        return;\n      }\n\n      // Filter Excel attachments\n      const excelAttachments = attachments.filter(attachment =>\n        attachment.name.endsWith(\".xlsx\") || attachment.name.endsWith(\".xls\")\n      );\n\n      if (excelAttachments.length === 0) {\n        console.log(\"üìÇ No Excel attachments found. Proceeding with sending email.\");\n        event.completed({ allowEvent: true });\n        return;\n      }\n\n      // Check if any Excel file contains the project number in the filename\n      const matchingAttachment = excelAttachments.some(attachment =>\n        attachment.name.includes(projectNumber)\n      );\n\n      if (!matchingAttachment) {\n        console.warn(\"‚ö† No matching Excel attachment found.\");\n\n        const dialogUrl = `https://colift.de/mailchecker/commands.html`;\n       //const dialogUrl = `https://localhost:3000/commands.html`;\n\n        // Open the dialog\n        Office.context.ui.displayDialogAsync(\n          dialogUrl,\n          { height: 40, width: 30, displayInIframe: true },\n          function (asyncResult) {\n            if (asyncResult.status !== Office.AsyncResultStatus.Succeeded) {\n              console.error(\"‚ùå Failed to open dialog:\", asyncResult.error);\n              event.completed({ allowEvent: true });\n              return;\n            }\n\n            const dialog = asyncResult.value;\n\n            // Add event handler to capture user action in the dialog\n            dialog.addEventHandler(\n              Office.EventType.DialogMessageReceived,\n              function (args) {\n                console.log(\"üì© Dialog Response:\", args.message);\n                dialog.close();\n\n                if (args.message === \"confirmed\") {\n                  console.log(\"‚úÖ User clicked OK. Proceeding with sending email.\");\n                  event.completed({ allowEvent: true });\n                } else {\n                  console.log(\"‚ùå User clicked Cancel. Blocking email.\");\n                  event.completed({ allowEvent: false });\n                }\n              }\n            );\n          }\n        );\n      } else {\n        console.log(\"‚úÖ Matching Excel attachment found. Proceeding with sending email.\");\n        event.completed({ allowEvent: true });\n      }\n    });\n  });\n}\n\n// Register the function with Office.\nOffice.actions.associate(\"action\", action);\n"],"names":["Office","onReady","actions","associate","event","item","context","mailbox","console","error","completed","allowEvent","subject","getAsync","result","status","AsyncResultStatus","Succeeded","value","log","projectNumberMatch","match","projectNumber","warn","getAttachmentsAsync","attachments","length","excelAttachments","filter","attachment","name","endsWith","some","includes","ui","displayDialogAsync","height","width","displayInIframe","asyncResult","dialog","addEventHandler","EventType","DialogMessageReceived","args","message","close"],"sourceRoot":""}